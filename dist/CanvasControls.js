"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("@babel/polyfill");
/**
 * @file CanvasControls.ts
 * @copyright Valen. H. 2k18
 * @author Valen.H. <alternativexxxy@gmail.com>
 */
/**
 * The root of the main library
 * @module CanvasControls
 */
var CanvasControls;
(function (CanvasControls) {
    /**
     * If `dest` lacks a property that `targ` has then that property is copied into `dest`.
    */
    function inherit(dest, targ, condition = (dest, targ, prop) => dest[prop] === undefined && (dest[prop] = targ[prop])) {
        for (let i in targ) {
            condition(dest, targ, i);
        }
        return dest;
    } //inherit
    /**
     * Restrict number's range
     */
    function bound(n, m, M) {
        return n > M ? M : (n < m ? m : n);
    } //bound
    /**
     * A holder for all errors
     */
    let Errors;
    (function (Errors) {
        Errors.ENOTCANV = new TypeError("Not an HTMLCanvasElement.");
        Errors.ENOTCTX = new TypeError("Not a CanvasRenderingContext2D.");
        Errors.ENOTNUMARR2 = new TypeError("Not an Array of 2-at-least Numbers.");
    })(Errors = CanvasControls.Errors || (CanvasControls.Errors = {})); //Errors
    /**
     * A wrapper for the targeted <canvas> element
     */
    class ControllableCanvas {
        constructor(opts = ControllableCanvas.defaultOpts) {
            inherit(opts, ControllableCanvas.defaultOpts);
            if (!(opts.target instanceof HTMLCanvasElement)) {
                throw Errors.ENOTCANV;
            }
            else if ([opts.trans, opts.scale, opts.rot, opts.pin, opts.transBounds].some(arr => !(arr instanceof Array || arr instanceof Float32Array || arr instanceof Float64Array) || arr.length < 2 || Array.from(arr).some((num) => isNaN(num) || num === ''))) {
                throw Errors.ENOTNUMARR2;
            }
            this.target = opts.target;
            this.context = this.target.getContext("2d");
            this.trans = Array.from(opts.trans).map(Number);
            this.scale = Array.from(opts.scale).map(Number);
            this.rot = Array.from(opts.rot).map(Number);
            this.pin = Array.from(opts.pin).map(Number);
            this.transBounds = Array.from(opts.pin).map(Number); // x, X, y, Y
            this.dragEnabled = !!opts.dragEnabled;
            this.pinchEnabled = !!opts.pinchEnabled;
            this.pinchSwipeEnabled = !!opts.pinchSwipeEnabled;
            this.wheelEnabled = !!opts.wheelEnabled;
            this.panEnabled = !!opts.panEnabled;
            this.tiltEnabled = !!opts.tiltEnabled;
            this.eventsReversed = !!opts.eventsReversed;
            this.blockRight = !!opts.blockRight;
            this._handled = false;
            this._adapts = {};
            this._mobile = ControllableCanvas.isMobile;
            this._pressed = false;
            this._coordinates = [0, 0];
            ControllableCanvas._linepix = ControllableCanvas.lineToPix;
        } //ctor
        get ratio() {
            return this.target.width / this.target.height;
        } //g-ratio
        get min() {
            return Math.min(this.target.width, this.target.height);
        } //g-min
        get max() {
            return Math.max(this.target.width, this.target.height);
        } //g-max
        handle() {
            if (!this._handled) {
                this._mobile ? this._mobileAdapt() : this._pcAdapt();
                return this._handled = true;
            }
            return false;
        } //handle
        retransform() {
            this.context.setTransform(1, 0, 0, 1, 0, 0);
            //@ts-ignore
            this.context.translate(...this.trans);
            //@ts-ignore
            this.context.scale(...this.scale);
            //@ts-ignore
            this.context.rotate(...this.rot);
            return this;
        } //retransform
        translate(...by) {
            return this.trans = this.trans.map((trn, idx) => bound(Number(trn + by[idx]), this.transBounds[idx], this.transBounds[idx + 2]));
        } //translate
        _mobileAdapt() {
            if (!this._adapts.drag) {
                this.target.addEventListener("touchstart", (e) => ControllableCanvas.dragMobileStart(e, this), { passive: false });
                this.target.addEventListener("touchmove", (e) => ControllableCanvas.dragMobileMove(e, this), { passive: false });
                this.target.addEventListener("touchend", (e) => ControllableCanvas.dragMobileEnd(e, this), { passive: false });
            }
            if (!this._adapts.pinch) {
            }
            if (!this._adapts.pinchSwipe) {
            }
            if (!this._adapts.tilt) {
            }
        } //_mobileAdapt
        _pcAdapt() {
            if (!this._adapts.drag) {
                this.target.addEventListener("mousemove", (e) => ControllableCanvas.dragPC(e, this));
                this.target.addEventListener("mousedown", (e) => this._pressed = true);
                this.target.addEventListener("mouseup", (e) => this._pressed = false);
                if (this.blockRight)
                    this.target.addEventListener("contextmenu", (e) => e.preventDefault(), { capture: true, passive: false });
            }
            if (!this._adapts.wheel) {
                this.target.addEventListener("wheel", (e) => ControllableCanvas.wheel(e, this));
            }
            if (!this._adapts.tilt) {
            }
        } //_pcAdapt
        static dragPC(event, cc) {
            if ((("buttons" in event) && (event.buttons & 2) === 2) || (("which" in event) && event.which === 3) || (("button" in event) && event.button === 2)) {
                return;
            }
            event.preventDefault();
            let coords = [event.clientX - cc.target.offsetLeft, event.clientY - cc.target.offsetTop];
            if (cc._pressed) {
                cc.translate(event.movementX * (1 / cc.scale[0]), event.movementY * (1 / cc.scale[1]));
            }
            cc._coordinates = coords;
        } //dragPC
        static dragMobileMove(event, cc) {
            event.preventDefault();
            let coords = [event.targetTouches[0].clientX - cc.target.offsetLeft, event.targetTouches[0].clientY - cc.target.offsetTop];
            if (event.targetTouches.length === 1) {
                cc.translate((coords[0] - cc._coordinates[0]) * (1 / cc.scale[0]), (coords[1] - cc._coordinates[1]) * (1 / cc.scale[1]));
            }
            cc._coordinates = coords;
        } //dragMobileMove
        static dragMobileStart(event, cc) {
            event.preventDefault();
            cc._coordinates = [event.targetTouches[0].clientX - cc.target.offsetLeft, event.targetTouches[0].clientY - cc.target.offsetTop];
        } //dragMobileStart
        static dragMobileEnd(event, cc) {
            event.preventDefault();
            if (event.targetTouches.length == 1) {
                ControllableCanvas.dragMobileStart(event, cc);
            }
        } //dragMobileEnd
        static wheel(event, cc) {
            let d = ControllableCanvas.fixDelta(event.deltaMode, event.deltaY);
        } //wheel
        static get isMobile() {
            if (navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/webOS/i)
                || navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPad/i)
                || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/Windows Phone/i)) {
                return true;
            }
            else {
                return false;
            }
        } //detectMobile
        static get lineToPix() {
            let r, iframe = document.createElement("iframe");
            iframe.src = '#';
            document.body.appendChild(iframe);
            let iwin = iframe.contentWindow, idoc = iwin.document;
            idoc.open();
            idoc.write('<!DOCTYPE html><html><head></head><body><p>a</p></body></html>');
            idoc.close();
            let span = idoc.body.firstElementChild;
            r = span.offsetHeight;
            document.body.removeChild(iframe);
            return r;
        } //lineToPix
        static fixDelta(mode, deltaY) {
            if (mode === 1) {
                return ControllableCanvas._linepix * deltaY;
            }
            else if (mode === 2) {
                return window.innerHeight;
            }
            else {
                return deltaY;
            }
        } //fixDelta
    } //ControllableCanvas
    ControllableCanvas.defaultOpts = {
        target: document.getElementsByTagName("canvas")[0],
        trans: [0, 0],
        scale: [1, 1],
        rot: [0, 0],
        pin: [window.innerWidth / 2, window.innerHeight / 2],
        dragEnabled: false,
        pinchEnabled: false,
        pinchSwipeEnabled: false,
        wheelEnabled: false,
        panEnabled: false,
        tiltEnabled: false,
        eventsReversed: false,
        blockRight: true,
        transBounds: [-Infinity, Infinity, -Infinity, Infinity]
    };
    CanvasControls.ControllableCanvas = ControllableCanvas;
})(CanvasControls = exports.CanvasControls || (exports.CanvasControls = {})); //CanvasControls
exports.default = CanvasControls.ControllableCanvas;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FudmFzQ29udHJvbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9saWIvQ2FudmFzQ29udHJvbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQkFBeUI7QUFFekI7Ozs7R0FJRztBQUdIOzs7R0FHRztBQUNILElBQWMsY0FBYyxDQXNUM0I7QUF0VEQsV0FBYyxjQUFjO0lBRTNCOztNQUVFO0lBQ0YsU0FBUyxPQUFPLENBQUMsSUFBUSxFQUFFLElBQVEsRUFBRSxZQUFzQixDQUFDLElBQVEsRUFBRSxJQUFRLEVBQUUsSUFBWSxFQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssU0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxSixLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksRUFBRTtZQUNuQixTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztTQUN6QjtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQyxDQUFDLFNBQVM7SUFFWDs7T0FFRztJQUNILFNBQVMsS0FBSyxDQUFDLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBUztRQUM3QyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BDLENBQUMsQ0FBQyxPQUFPO0lBdURUOztPQUVHO0lBQ0gsSUFBaUIsTUFBTSxDQUl0QjtJQUpELFdBQWlCLE1BQU07UUFDVCxlQUFRLEdBQVUsSUFBSSxTQUFTLENBQUMsMkJBQTJCLENBQUMsQ0FBQztRQUM3RCxjQUFPLEdBQVUsSUFBSSxTQUFTLENBQUMsaUNBQWlDLENBQUMsQ0FBQztRQUNsRSxrQkFBVyxHQUFVLElBQUksU0FB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b0I7SUF2TWQsOEJBQVcsR0FBbUM7UUFDcEQsTUFBTSxFQUFFLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNiLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDYixHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ1gsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxDQUFDLEVBQUUsTUFBTSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUM7UUFDcEQsV0FBVyxFQUFFLEtBQUs7UUFDbEIsWUFBWSxFQUFFLEtBQUs7UUFDbkIsaUJBQWlCLEVBQUUsS0FBSztRQUN4QixZQUFZLEVBQUUsS0FBSztRQUNuQixVQUFVLEVBQUUsS0FBSztRQUNqQixXQUFXLEVBQUUsS0FBSztRQUNsQixjQUFjLEVBQUUsS0FBSztRQUNyQixVQUFVLEVBQUUsSUFBSTtRQUNoQixXQUFXLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDO0tBQ3ZELENBQUM7SUF0Q1UsaUNBQWtCLHFCQThOOUIsQ0FBQTtBQUVGLENBQUMsRUF0VGEsY0FBYyxHQUFkLHNCQUFjLEtBQWQsc0JBQWMsUUFzVDNCLENBQUMsZ0JBQWdCO0FBRWxCLGtCQUFlLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcIkBiYWJlbC9wb2x5ZmlsbFwiO1xuXG4vKipcbiAqIEBmaWxlIENhbnZhc0NvbnRyb2xzLnRzXG4gKiBAY29weXJpZ2h0IFZhbGVuLiBILiAyazE4XG4gKiBAYXV0aG9yIFZhbGVuLkguIDxhbHRlcm5hdGl2ZXh4eHlAZ21haWwuY29tPlxuICovXG5cblxuLyoqXG4gKiBUaGUgcm9vdCBvZiB0aGUgbWFpbiBsaWJyYXJ5XG4gKiBAbW9kdWxlIENhbnZhc0NvbnRyb2xzXG4gKi9cbmV4cG9ydCBtb2R1bGUgQ2FudmFzQ29udHJvbHMge1xuXG5cdC8qKlxuXHQgKiBJZiBgZGVzdGAgbGFja3MgYSBwcm9wZXJ0eSB0aGF0IGB0YXJnYCBoYXMgdGhlbiB0aGF0IHByb3BlcnR5IGlzIGNvcGllZCBpbnRvIGBkZXN0YC5cblx0Ki9cblx0ZnVuY3Rpb24gaW5oZXJpdChkZXN0OiB7fSwgdGFyZzoge30sIGNvbmRpdGlvbjogRnVuY3Rpb24gPSAoZGVzdDoge30sIHRhcmc6IHt9LCBwcm9wOiBzdHJpbmcpOiBhbnkgPT4gZGVzdFtwcm9wXSA9PT0gdW5kZWZpbmVkICYmIChkZXN0W3Byb3BdID0gdGFyZ1twcm9wXSkpOiB7fSB7XG5cdFx0Zm9yIChsZXQgaSBpbiB0YXJnKSB7XG5cdFx0XHRjb25kaXRpb24oZGVzdCwgdGFyZywgaSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRlc3Q7XG5cdH0gLy9pbmhlcml0XG5cblx0LyoqXG5cdCAqIFJlc3RyaWN0IG51bWJlcidzIHJhbmdlXG5cdCAqL1xuXHRmdW5jdGlvbiBib3VuZChuOiBudW1iZXIsIG06IG51bWJlciwgTTogbnVtYmVyKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gbiA+IE0gPyBNIDogKG4gPCBtID8gbSA6IG4pO1xuXHR9IC8vYm91bmRcblxuXG5cdC8qKlxuXHQgKiBBIG5hbWVzcGFjZSB0aGF0IGhvbGRzIGFsbCBvcHRpb25zIGFuZCBpbnRlcmZhY2VzIG9mIHRoZSBtb2R1bGVcblx0ICovXG5cdGV4cG9ydCBkZWNsYXJlIG5hbWVzcGFjZSBPcHRzIHtcblx0XHRleHBvcnQgaW50ZXJmYWNlIENvbnRyb2xsYWJsZUNhbnZhc09wdGlvbnMge1xuXHRcdFx0dGFyZ2V0OiBIVE1MQ2FudmFzRWxlbWVudDtcblx0XHRcdHRyYW5zOiBudW1iZXJbXTtcblx0XHRcdHNjYWxlOiBudW1iZXJbXTtcblx0XHRcdHJvdDogbnVtYmVyW107XG5cdFx0XHRwaW46IG51bWJlcltdO1xuXHRcdFx0ZHJhZ0VuYWJsZWQ6IGJvb2xlYW47XG5cdFx0XHRwaW5jaEVuYWJsZWQ6IGJvb2xlYW47XG5cdFx0XHRwaW5jaFN3aXBlRW5hYmxlZDogYm9vbGVhbjtcblx0XHRcdHdoZWVsRW5hYmxlZDogYm9vbGVhbjtcblx0XHRcdHBhbkVuYWJsZWQ6IGJvb2xlYW47XG5cdFx0XHR0aWx0RW5hYmxlZDogYm9vbGVhbjtcblx0XHRcdGV2ZW50c1JldmVyc2VkOiBib29sZWFuO1xuXHRcdFx0YmxvY2tSaWdodDogYm9vbGVhbjtcblx0XHRcdHRyYW5zQm91bmRzOiBudW1iZXJbXTtcblx0XHRcdFtwcm9wOiBzdHJpbmddOiBhbnk7XG5cdFx0fSAvL0NvbnRyb2xsYWJsZUNhbnZhc09wdGlvbnNcblxuXHRcdC8qKlxuXHRcdCAqIE06IG1vYmlsZVxuXHRcdCAqIFA6IHBjXG5cdFx0ICogTVA6IGJvdGhcblx0XHQgKiBcblx0XHQgKiBkcmFnOlxuXHRcdCAqXHRQOiBtb3VzZSAgaG9sZCAmIG1vdmVcblx0XHQgKlx0TTogdG91Y2ggIGhvbGQgJiBtb3ZlXG5cdFx0ICogcGluY2g6XG5cdFx0ICpcdHRvdWNoICAyLWZpbmdlciAmIDEtbW92ZVxuXHRcdCAqIHBpbmNoU3dpcGU6XG5cdFx0ICpcdHRvdWNoICAyLWZpbmdlciAmIDItbW92ZVxuXHRcdCAqIHdoZWVsOlxuXHRcdCAqXHR3aGVlbCAgbW92ZSAgW3BjIHBpbmNoLWVxdWl2YWxlbnRdXG5cdFx0ICogcGFuOlxuXHRcdCAqXHRkaXNwb3NpdGlvbiBmcm9tIGNlbnRlciBjYXVzZXMgY29uc3RhbnQgdHJhbnNsYXRpb25cblx0XHQgKiB0aWx0OlxuXHRcdCAqXHRkZXZpY2Vtb3Rpb24gIGNhdXNlcyBwYW5uaW5nKlxuXHRcdCAqL1xuXHRcdGV4cG9ydCBpbnRlcmZhY2UgQ29udHJvbGxhYmxlQ2FudmFzQWRhcHRlcnMge1xuXHRcdFx0ZHJhZz86IEZ1bmN0aW9uOyAgLy9NUFxuXHRcdFx0cGluY2g/OiBGdW5jdGlvbjsgIC8vTVxuXHRcdFx0cGluY2hTd2lwZT86IEZ1bmN0aW9uOyAgLy9NXG5cdFx0XHR3aGVlbD86IEZ1bmN0aW9uOyAgLy9QXG5cdFx0XHRwYW4/OiBGdW5jdGlvbiAgLy9NUFxuXHRcdFx0dGlsdD86IEZ1bmN0aW9uICAvL01QXG5cdFx0XHRbcHJvcDogc3RyaW5nXTogYW55O1xuXHRcdH1cblx0fSAvL09wdHNcblxuXHQvKipcblx0ICogQSBob2xkZXIgZm9yIGFsbCBlcnJvcnNcblx0ICovXG5cdGV4cG9ydCBuYW1lc3BhY2UgRXJyb3JzIHtcblx0XHRleHBvcnQgY29uc3QgRU5PVENBTlY6IEVycm9yID0gbmV3IFR5cGVFcnJvcihcIk5vdCBhbiBIVE1MQ2FudmFzRWxlbWVudC5cIik7XG5cdFx0ZXhwb3J0IGNvbnN0IEVOT1RDVFg6IEVycm9yID0gbmV3IFR5cGVFcnJvcihcIk5vdCBhIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5cIik7XG5cdFx0ZXhwb3J0IGNvbnN0IEVOT1ROVU1BUlIyOiBFcnJvciA9IG5ldyBUeXBlRXJyb3IoXCJOb3QgYW4gQXJyYXkgb2YgMi1hdC1sZWFzdCBOdW1iZXJzLlwiKTtcblx0fSAvL0Vycm9yc1xuXG5cdFxuXHQvKipcblx0ICogQSB3cmFwcGVyIGZvciB0aGUgdGFyZ2V0ZWQgPGNhbnZhcz4gZWxlbWVudFxuXHQgKi9cblx0ZXhwb3J0IGNsYXNzIENvbnRyb2xsYWJsZUNhbnZhcyBpbXBsZW1lbnRzIE9wdHMuQ29udHJvbGxhYmxlQ2FudmFzT3B0aW9ucyB7XG5cdFx0dGFyZ2V0OiBIVE1MQ2FudmFzRWxlbWVudDtcblx0XHRjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG5cdFx0dHJhbnM6IG51bWJlcltdO1xuXHRcdHNjYWxlOiBudW1iZXJbXTtcblx0XHRyb3Q6IG51bWJlcltdO1xuXHRcdHBpbjogbnVtYmVyW107XG5cdFx0dHJhbnNCb3VuZHM6IG51bWJlcltdO1xuXHRcdGRyYWdFbmFibGVkOiBib29sZWFuO1xuXHRcdHBpbmNoRW5hYmxlZDogYm9vbGVhbjtcblx0XHRwaW5jaFN3aXBlRW5hYmxlZDogYm9vbGVhbjtcblx0XHR3aGVlbEVuYWJsZWQ6IGJvb2xlYW47XG5cdFx0cGFuRW5hYmxlZDogYm9vbGVhbjtcblx0XHR0aWx0RW5hYmxlZDogYm9vbGVhbjtcblx0XHRldmVudHNSZXZlcnNlZDogYm9vbGVhbjtcblx0XHRibG9ja1JpZ2h0OiBib29sZWFuO1xuXHRcdHByaXZhdGUgX2hhbmRsZWQ6IGJvb2xlYW47XG5cdFx0cHJpdmF0ZSBfbW9iaWxlOiBib29sZWFuO1xuXHRcdHByaXZhdGUgX3ByZXNzZWQ6IGJvb2xlYW47XG5cdFx0cHJpdmF0ZSBfYWRhcHRzOiBPcHRzLkNvbnRyb2xsYWJsZUNhbnZhc0FkYXB0ZXJzO1xuXHRcdF9jb29yZGluYXRlczogbnVtYmVyW107XG5cblx0XHRwcml2YXRlIHN0YXRpYyBfbGluZXBpeDogbnVtYmVyO1xuXHRcdHN0YXRpYyBkZWZhdWx0T3B0czogT3B0cy5Db250cm9sbGFibGVDYW52YXNPcHRpb25zID0ge1xuXHRcdFx0dGFyZ2V0OiBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImNhbnZhc1wiKVswXSxcblx0XHRcdHRyYW5zOiBbMCwgMF0sXG5cdFx0XHRzY2FsZTogWzEsIDFdLFxuXHRcdFx0cm90OiBbMCwgMF0sXG5cdFx0XHRwaW46IFt3aW5kb3cuaW5uZXJXaWR0aCAvIDIsIHdpbmRvdy5pbm5lckhlaWdodCAvIDJdLFxuXHRcdFx0ZHJhZ0VuYWJsZWQ6IGZhbHNlLFxuXHRcdFx0cGluY2hFbmFibGVkOiBmYWxzZSxcblx0XHRcdHBpbmNoU3dpcGVFbmFibGVkOiBmYWxzZSxcblx0XHRcdHdoZWVsRW5hYmxlZDogZmFsc2UsXG5cdFx0XHRwYW5FbmFibGVkOiBmYWxzZSxcblx0XHRcdHRpbHRFbmFibGVkOiBmYWxzZSxcblx0XHRcdGV2ZW50c1JldmVyc2VkOiBmYWxzZSxcblx0XHRcdGJsb2NrUmlnaHQ6IHRydWUsXG5cdFx0XHR0cmFuc0JvdW5kczogWy1JbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgSW5maW5pdHldXG5cdFx0fTtcblxuXHRcdGNvbnN0cnVjdG9yKG9wdHM6IE9wdHMuQ29udHJvbGxhYmxlQ2FudmFzT3B0aW9ucyA9IENvbnRyb2xsYWJsZUNhbnZhcy5kZWZhdWx0T3B0cykge1xuXHRcdFx0aW5oZXJpdChvcHRzLCBDb250cm9sbGFibGVDYW52YXMuZGVmYXVsdE9wdHMpO1xuXHRcdFx0XG5cdFx0XHRpZiAoIShvcHRzLnRhcmdldCBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50KSkge1xuXHRcdFx0XHR0aHJvdyBFcnJvcnMuRU5PVENBTlY7XG5cdFx0XHR9IGVsc2UgaWYgKFtvcHRzLnRyYW5zLCBvcHRzLnNjYWxlLCBvcHRzLnJvdCwgb3B0cy5waW4sIG9wdHMudHJhbnNCb3VuZHNdLnNvbWUoYXJyID0+ICEoYXJyIGluc3RhbmNlb2YgQXJyYXkgfHwgPGFueT5hcnIgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkgfHwgPGFueT5hcnIgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpIHx8IGFyci5sZW5ndGggPCAyIHx8IEFycmF5LmZyb20oYXJyKS5zb21lKChudW06IGFueSkgPT4gaXNOYU4obnVtKSB8fCBudW0gPT09ICcnKSkpIHtcblx0XHRcdFx0dGhyb3cgRXJyb3JzLkVOT1ROVU1BUlIyO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLnRhcmdldCA9IG9wdHMudGFyZ2V0O1xuXHRcdFx0dGhpcy5jb250ZXh0ID0gdGhpcy50YXJnZXQuZ2V0Q29udGV4dChcIjJkXCIpO1xuXG5cdFx0XHR0aGlzLnRyYW5zID0gQXJyYXkuZnJvbShvcHRzLnRyYW5zKS5tYXAoTnVtYmVyKTtcblx0XHRcdHRoaXMuc2NhbGUgPSBBcnJheS5mcm9tKG9wdHMuc2NhbGUpLm1hcChOdW1iZXIpO1xuXHRcdFx0dGhpcy5yb3QgPSBBcnJheS5mcm9tKG9wdHMucm90KS5tYXAoTnVtYmVyKTtcblx0XHRcdHRoaXMucGluID0gQXJyYXkuZnJvbShvcHRzLnBpbikubWFwKE51bWJlcik7XG5cdFx0XHR0aGlzLnRyYW5zQm91bmRzID0gQXJyYXkuZnJvbShvcHRzLnBpbikubWFwKE51bWJlcik7ICAvLyB4LCBYLCB5LCBZXG5cblx0XHRcdHRoaXMuZHJhZ0VuYWJsZWQgPSAhIW9wdHMuZHJhZ0VuYWJsZWQ7XG5cdFx0XHR0aGlzLnBpbmNoRW5hYmxlZCA9ICEhb3B0cy5waW5jaEVuYWJsZWQ7XG5cdFx0XHR0aGlzLnBpbmNoU3dpcGVFbmFibGVkID0gISFvcHRzLnBpbmNoU3dpcGVFbmFibGVkO1xuXHRcdFx0dGhpcy53aGVlbEVuYWJsZWQgPSAhIW9wdHMud2hlZWxFbmFibGVkO1xuXHRcdFx0dGhpcy5wYW5FbmFibGVkID0gISFvcHRzLnBhbkVuYWJsZWQ7XG5cdFx0XHR0aGlzLnRpbHRFbmFibGVkID0gISFvcHRzLnRpbHRFbmFibGVkO1xuXHRcdFx0dGhpcy5ldmVudHNSZXZlcnNlZCA9ICEhb3B0cy5ldmVudHNSZXZlcnNlZDtcblx0XHRcdHRoaXMuYmxvY2tSaWdodCA9ICEhb3B0cy5ibG9ja1JpZ2h0O1xuXG5cdFx0XHR0aGlzLl9oYW5kbGVkID0gZmFsc2U7XG5cdFx0XHR0aGlzLl9hZGFwdHMgPSB7IH07XG5cdFx0XHR0aGlzLl9tb2JpbGUgPSBDb250cm9sbGFibGVDYW52YXMuaXNNb2JpbGU7XG5cdFx0XHR0aGlzLl9wcmVzc2VkID0gZmFsc2U7XG5cdFx0XHR0aGlzLl9jb29yZGluYXRlcyA9IFswLCAwXTtcblx0XHRcdENvbnRyb2xsYWJsZUNhbnZhcy5fbGluZXBpeCA9IENvbnRyb2xsYWJsZUNhbnZhcy5saW5lVG9QaXg7XG5cdFx0fSAvL2N0b3JcblxuXHRcdGdldCByYXRpbygpIHtcblx0XHRcdHJldHVybiB0aGlzLnRhcmdldC53aWR0aCAvIHRoaXMudGFyZ2V0LmhlaWdodDtcblx0XHR9IC8vZy1yYXRpb1xuXG5cdFx0Z2V0IG1pbigpIHtcblx0XHRcdHJldHVybiBNYXRoLm1pbih0aGlzLnRhcmdldC53aWR0aCwgdGhpcy50YXJnZXQuaGVpZ2h0KTtcblx0XHR9IC8vZy1taW5cblx0XHRnZXQgbWF4KCkge1xuXHRcdFx0cmV0dXJuIE1hdGgubWF4KHRoaXMudGFyZ2V0LndpZHRoLCB0aGlzLnRhcmdldC5oZWlnaHQpO1xuXHRcdH0gLy9nLW1heFxuXG5cdFx0aGFuZGxlKCk6IGJvb2xlYW4ge1xuXHRcdFx0aWYgKCF0aGlzLl9oYW5kbGVkKSB7XG5cdFx0XHRcdHRoaXMuX21vYmlsZSA/IHRoaXMuX21vYmlsZUFkYXB0KCkgOiB0aGlzLl9wY0FkYXB0KCk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9oYW5kbGVkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9IC8vaGFuZGxlXG5cblxuXHRcdHJldHJhbnNmb3JtKCk6IFRoaXNUeXBlPENvbnRyb2xsYWJsZUNhbnZhcz4ge1xuXHRcdFx0dGhpcy5jb250ZXh0LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCAwLCAwKTtcblx0XHRcdC8vQHRzLWlnbm9yZVxuXHRcdFx0dGhpcy5jb250ZXh0LnRyYW5zbGF0ZSguLi50aGlzLnRyYW5zKTtcblx0XHRcdC8vQHRzLWlnbm9yZVxuXHRcdFx0dGhpcy5jb250ZXh0LnNjYWxlKC4uLnRoaXMuc2NhbGUpO1xuXHRcdFx0Ly9AdHMtaWdub3JlXG5cdFx0XHR0aGlzLmNvbnRleHQucm90YXRlKC4uLnRoaXMucm90KTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gLy9yZXRyYW5zZm9ybVxuXG5cdFx0dHJhbnNsYXRlKC4uLmJ5OiBudW1iZXJbXSk6IG51bWJlcltdIHtcblx0XHRcdHJldHVybiB0aGlzLnRyYW5zID0gdGhpcy50cmFucy5tYXAoKHRybjogbnVtYmVyLCBpZHg6IG51bWJlcikgPT4gYm91bmQoTnVtYmVyKHRybiArIGJ5W2lkeF0pLCB0aGlzLnRyYW5zQm91bmRzW2lkeF0sIHRoaXMudHJhbnNCb3VuZHNbaWR4ICsgMl0pKTtcblx0XHR9IC8vdHJhbnNsYXRlXG5cblxuXHRcdHByaXZhdGUgX21vYmlsZUFkYXB0KCk6IHZvaWQge1xuXHRcdFx0aWYgKCF0aGlzLl9hZGFwdHMuZHJhZykge1xuXHRcdFx0XHR0aGlzLnRhcmdldC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoZTogVG91Y2hFdmVudCkgPT4gQ29udHJvbGxhYmxlQ2FudmFzLmRyYWdNb2JpbGVTdGFydChlLCB0aGlzKSwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcblx0XHRcdFx0dGhpcy50YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCAoZTogVG91Y2hFdmVudCkgPT4gQ29udHJvbGxhYmxlQ2FudmFzLmRyYWdNb2JpbGVNb3ZlKGUsIHRoaXMpLCB7IHBhc3NpdmU6IGZhbHNlIH0pO1xuXHRcdFx0XHR0aGlzLnRhcmdldC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgKGU6IFRvdWNoRXZlbnQpID0+IENvbnRyb2xsYWJsZUNhbnZhcy5kcmFnTW9iaWxlRW5kKGUsIHRoaXMpLCB7IHBhc3NpdmU6IGZhbHNlIH0pO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCF0aGlzLl9hZGFwdHMucGluY2gpIHtcblxuXHRcdFx0fVxuXHRcdFx0aWYgKCF0aGlzLl9hZGFwdHMucGluY2hTd2lwZSkge1xuXG5cdFx0XHR9XG5cdFx0XHRpZiAoIXRoaXMuX2FkYXB0cy50aWx0KSB7XG5cblx0XHRcdH1cblx0XHR9IC8vX21vYmlsZUFkYXB0XG5cdFx0cHJpdmF0ZSBfcGNBZGFwdCgpOiB2b2lkIHtcblx0XHRcdGlmICghdGhpcy5fYWRhcHRzLmRyYWcpIHtcblx0XHRcdFx0dGhpcy50YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCAoZTogTW91c2VFdmVudCkgPT4gQ29udHJvbGxhYmxlQ2FudmFzLmRyYWdQQyhlLCB0aGlzKSk7XG5cdFx0XHRcdHRoaXMudGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGU/OiBNb3VzZUV2ZW50KSA9PiB0aGlzLl9wcmVzc2VkID0gdHJ1ZSk7XG5cdFx0XHRcdHRoaXMudGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIChlPzogTW91c2VFdmVudCkgPT4gdGhpcy5fcHJlc3NlZCA9IGZhbHNlKTtcblx0XHRcdFx0aWYgKHRoaXMuYmxvY2tSaWdodCkgdGhpcy50YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIChlOiBNb3VzZUV2ZW50KSA9PiBlLnByZXZlbnREZWZhdWx0KCksIHsgY2FwdHVyZTogdHJ1ZSwgcGFzc2l2ZTogZmFsc2UgfSk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIXRoaXMuX2FkYXB0cy53aGVlbCkge1xuXHRcdFx0XHR0aGlzLnRhcmdldC5hZGRFdmVudExpc3RlbmVyKFwid2hlZWxcIiwgKGU6IFdoZWVsRXZlbnQpID0+IENvbnRyb2xsYWJsZUNhbnZhcy53aGVlbChlLCB0aGlzKSk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIXRoaXMuX2FkYXB0cy50aWx0KSB7XG5cblx0XHRcdH1cblx0XHR9IC8vX3BjQWRhcHRcblxuXHRcdHN0YXRpYyBkcmFnUEMoZXZlbnQ6IE1vdXNlRXZlbnQsIGNjOiBDb250cm9sbGFibGVDYW52YXMpOiB2b2lkIHtcblx0XHRcdGlmICgoKFwiYnV0dG9uc1wiIGluIGV2ZW50KSAmJiAoZXZlbnQuYnV0dG9ucyAmIDIpID09PSAyKSB8fCAoKFwid2hpY2hcIiBpbiBldmVudCkgJiYgZXZlbnQud2hpY2ggPT09IDMpIHx8ICgoXCJidXR0b25cIiBpbiBldmVudCkgJiYgZXZlbnQuYnV0dG9uID09PSAyKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGxldCBjb29yZHM6IG51bWJlcltdID0gW2V2ZW50LmNsaWVudFggLSBjYy50YXJnZXQub2Zmc2V0TGVmdCwgZXZlbnQuY2xpZW50WSAtIGNjLnRhcmdldC5vZmZzZXRUb3BdO1xuXG5cdFx0XHRpZiAoY2MuX3ByZXNzZWQpIHtcblx0XHRcdFx0Y2MudHJhbnNsYXRlKGV2ZW50Lm1vdmVtZW50WCAqICgxIC8gY2Muc2NhbGVbMF0pLCBldmVudC5tb3ZlbWVudFkgKiAoMSAvIGNjLnNjYWxlWzFdKSk7XG5cdFx0XHR9XG5cblx0XHRcdGNjLl9jb29yZGluYXRlcyA9IGNvb3Jkcztcblx0XHR9IC8vZHJhZ1BDXG5cblx0XHRzdGF0aWMgZHJhZ01vYmlsZU1vdmUoZXZlbnQ6IFRvdWNoRXZlbnQsIGNjOiBDb250cm9sbGFibGVDYW52YXMpOiB2b2lkIHtcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGxldCBjb29yZHM6IG51bWJlcltdID0gW2V2ZW50LnRhcmdldFRvdWNoZXNbMF0uY2xpZW50WCAtIGNjLnRhcmdldC5vZmZzZXRMZWZ0LCBldmVudC50YXJnZXRUb3VjaGVzWzBdLmNsaWVudFkgLSBjYy50YXJnZXQub2Zmc2V0VG9wXTtcblxuXHRcdFx0aWYgKGV2ZW50LnRhcmdldFRvdWNoZXMubGVuZ3RoID09PSAxKSB7XG5cdFx0XHRcdGNjLnRyYW5zbGF0ZSgoY29vcmRzWzBdIC0gY2MuX2Nvb3JkaW5hdGVzWzBdKSAqICgxIC8gY2Muc2NhbGVbMF0pLCAoY29vcmRzWzFdIC0gY2MuX2Nvb3JkaW5hdGVzWzFdKSAqICgxIC8gY2Muc2NhbGVbMV0pKTtcblx0XHRcdH1cblxuXHRcdFx0Y2MuX2Nvb3JkaW5hdGVzID0gY29vcmRzO1xuXHRcdH0gLy9kcmFnTW9iaWxlTW92ZVxuXHRcdHN0YXRpYyBkcmFnTW9iaWxlU3RhcnQoZXZlbnQ6IFRvdWNoRXZlbnQsIGNjOiBDb250cm9sbGFibGVDYW52YXMpOiB2b2lkIHtcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRjYy5fY29vcmRpbmF0ZXMgPSBbZXZlbnQudGFyZ2V0VG91Y2hlc1swXS5jbGllbnRYIC0gY2MudGFyZ2V0Lm9mZnNldExlZnQsIGV2ZW50LnRhcmdldFRvdWNoZXNbMF0uY2xpZW50WSAtIGNjLnRhcmdldC5vZmZzZXRUb3BdO1xuXHRcdH0gLy9kcmFnTW9iaWxlU3RhcnRcblx0XHRzdGF0aWMgZHJhZ01vYmlsZUVuZChldmVudDogVG91Y2hFdmVudCwgY2M6IENvbnRyb2xsYWJsZUNhbnZhcyk6IHZvaWQge1xuXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGlmIChldmVudC50YXJnZXRUb3VjaGVzLmxlbmd0aCA9PSAxKSB7XG5cdFx0XHRcdENvbnRyb2xsYWJsZUNhbnZhcy5kcmFnTW9iaWxlU3RhcnQoZXZlbnQsIGNjKTtcblx0XHRcdH1cblx0XHR9IC8vZHJhZ01vYmlsZUVuZFxuXG5cdFx0c3RhdGljIHdoZWVsKGV2ZW50OiBXaGVlbEV2ZW50LCBjYzogQ29udHJvbGxhYmxlQ2FudmFzKTogdm9pZCB7XG5cdFx0XHRsZXQgZCA9IENvbnRyb2xsYWJsZUNhbnZhcy5maXhEZWx0YShldmVudC5kZWx0YU1vZGUsIGV2ZW50LmRlbHRhWSk7XG5cdFx0fSAvL3doZWVsXG5cblxuXHRcdHByaXZhdGUgc3RhdGljIGdldCBpc01vYmlsZSgpOiBib29sZWFuIHtcblx0XHRcdGlmIChuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9BbmRyb2lkL2kpIHx8IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL3dlYk9TL2kpXG5cdFx0XHRcdHx8IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL2lQaG9uZS9pKSB8fCBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9pUGFkL2kpXG5cdFx0XHRcdHx8IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL2lQb2QvaSkgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvQmxhY2tCZXJyeS9pKSB8fCBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9XaW5kb3dzIFBob25lL2kpXG5cdFx0XHQpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSAvL2RldGVjdE1vYmlsZVxuXG5cdFx0cHJpdmF0ZSBzdGF0aWMgZ2V0IGxpbmVUb1BpeCgpOiBudW1iZXIge1xuXHRcdFx0bGV0IHI6IG51bWJlcixcblx0XHRcdFx0aWZyYW1lOiBIVE1MSUZyYW1lRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XG5cdFx0XHRpZnJhbWUuc3JjID0gJyMnO1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpO1xuXHRcdFx0bGV0IGl3aW46IFdpbmRvdyA9IGlmcmFtZS5jb250ZW50V2luZG93LFxuXHRcdFx0XHRpZG9jOiBEb2N1bWVudCA9IGl3aW4uZG9jdW1lbnQ7XG5cdFx0XHRpZG9jLm9wZW4oKTtcblx0XHRcdGlkb2Mud3JpdGUoJzwhRE9DVFlQRSBodG1sPjxodG1sPjxoZWFkPjwvaGVhZD48Ym9keT48cD5hPC9wPjwvYm9keT48L2h0bWw+Jyk7XG5cdFx0XHRpZG9jLmNsb3NlKCk7XG5cdFx0XHRsZXQgc3BhbjogSFRNTEVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+aWRvYy5ib2R5LmZpcnN0RWxlbWVudENoaWxkO1xuXHRcdFx0ciA9IHNwYW4ub2Zmc2V0SGVpZ2h0O1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChpZnJhbWUpO1xuXHRcdFx0cmV0dXJuIHI7XG5cdFx0fSAvL2xpbmVUb1BpeFxuXG5cdFx0cHJpdmF0ZSBzdGF0aWMgZml4RGVsdGEobW9kZTogbnVtYmVyLCBkZWx0YVk6IG51bWJlcik6IG51bWJlciB7XG5cdFx0XHRpZiAobW9kZSA9PT0gMSkge1xuXHRcdFx0XHRyZXR1cm4gQ29udHJvbGxhYmxlQ2FudmFzLl9saW5lcGl4ICogZGVsdGFZO1xuXHRcdFx0fSBlbHNlIGlmIChtb2RlID09PSAyKSB7XG5cdFx0XHRcdHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gZGVsdGFZO1xuXHRcdFx0fVxuXHRcdH0gLy9maXhEZWx0YVxuXHRcdFxuXHR9IC8vQ29udHJvbGxhYmxlQ2FudmFzXG5cbn0gLy9DYW52YXNDb250cm9sc1xuXG5leHBvcnQgZGVmYXVsdCBDYW52YXNDb250cm9scy5Db250cm9sbGFibGVDYW52YXM7XG4iXX0=